<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GERKA - PUZZLE</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: white;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .game-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 800px;
            width: 100%;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255,255,255,0.15);
            border-radius: 10px;
        }

        .stats {
            display: flex;
            gap: 20px;
        }

        .stat-box {
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        button:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        .restart-btn {
            background: #ff9800;
        }

        .restart-btn:hover {
            background: #f57c00;
        }

        .level-btn {
            background: #2196F3;
        }

        .level-btn:hover {
            background: #1976D2;
        }

        .puzzle-container {
            display: grid;
            gap: 2px;
            background: rgba(0,0,0,0.2);
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 20px;
            min-height: 400px;
            justify-content: center;
        }

        .puzzle-piece {
            background-size: cover;
            cursor: pointer;
            border: 2px solid white;
            border-radius: 5px;
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .puzzle-piece:hover {
            transform: scale(1.02);
            border-color: #4CAF50;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
        }

        .puzzle-piece.empty {
            background: rgba(255,255,255,0.1);
            border: 2px dashed rgba(255,255,255,0.3);
            cursor: default;
            text-shadow: none;
        }

        .puzzle-piece.empty:hover {
            transform: none;
            border-color: rgba(255,255,255,0.3);
            box-shadow: none;
        }

        .image-selector {
            margin-top: 20px;
            text-align: center;
        }

        .image-options {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .image-option {
            width: 100px;
            height: 100px;
            border-radius: 10px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s ease;
            object-fit: cover;
        }

        .image-option:hover {
            transform: scale(1.05);
        }

        .image-option.selected {
            border-color: #4CAF50;
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.5);
        }

        .win-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            display: none;
            z-index: 1000;
            box-shadow: 0 0 50px rgba(76, 175, 80, 0.5);
        }

        .win-message.show {
            display: block;
            animation: popUp 0.5s ease;
        }

        @keyframes popUp {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .win-title {
            font-size: 2.5rem;
            color: #4CAF50;
            margin-bottom: 20px;
        }

        .win-stats {
            font-size: 1.2rem;
            margin-bottom: 30px;
        }

        .instructions {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .instructions h3 {
            margin-bottom: 10px;
            color: #4CAF50;
        }

        @media (max-width: 768px) {
            .game-container {
                padding: 15px;
            }
            
            .controls {
                justify-content: center;
            }
            
            .puzzle-container {
                min-height: 300px;
            }
            
            .image-option {
                width: 80px;
                height: 80px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸ§© GERKA - PUZZLE GAME</h1>
    </div>

    <div class="game-container">
        <div class="game-info">
            <div class="stats">
                <div class="stat-box">
                    <div class="stat-value" id="moves">0</div>
                    <div class="stat-label">Langkah</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="time">00:00</div>
                    <div class="stat-label">Waktu</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="level">3x3</div>
                    <div class="stat-label">Level</div>
                </div>
            </div>
            <button class="restart-btn" onclick="restartGame()">
                ðŸ”„ Restart
            </button>
        </div>

        <div class="controls">
            <button onclick="changeLevel(3)" class="level-btn">
                ðŸŸ¦ Mudah (3x3)
            </button>
            <button onclick="changeLevel(4)" class="level-btn">
                ðŸŸ¨ Sedang (4x4)
            </button>
            <button onclick="changeLevel(5)" class="level-btn">
                ðŸŸ¥ Sulit (5x5)
            </button>
            <button onclick="toggleSound()" class="level-btn" id="soundBtn">
                ðŸ”Š Sound On
            </button>
        </div>

        <div class="puzzle-container" id="puzzleContainer"></div>

        <div class="image-selector">
            <h3>Pilih Gambar:</h3>
            <div class="image-options">
                <img src="https://images.unsplash.com/photo-1506744038136-46273834b3fb" class="image-option selected" onclick="selectImage(this, 'https://images.unsplash.com/photo-1506744038136-46273834b3fb')">
                <img src="https://images.unsplash.com/photo-1519681393784-d120267933ba" class="image-option" onclick="selectImage(this, 'https://images.unsplash.com/photo-1519681393784-d120267933ba')">
                <img src="https://images.unsplash.com/photo-1501785888041-af3ef285b470" class="image-option" onclick="selectImage(this, 'https://images.unsplash.com/photo-1501785888041-af3ef285b470')">
                <img src="https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05" class="image-option" onclick="selectImage(this, 'https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05')">
            </div>
        </div>

        <div class="instructions">
            <h3>Cara Bermain:</h3>
            <p>1. Pilih gambar dan tingkat kesulitan</p>
            <p>2. Klik potongan puzzle untuk memindahkannya ke posisi kosong yang bersebelahan</p>
            <p>3. Susun semua potongan hingga gambar utuh terbentuk</p>
            <p>4. Angka pada potongan membantu debugging</p>
        </div>
    </div>

    <div class="win-message" id="winMessage">
        <div class="win-title">ðŸŽ‰ Selamat! ðŸŽ‰</div>
        <div class="win-stats">
            <p>Puzzle selesai dalam <span id="finalMoves">0</span> langkah</p>
            <p>Waktu: <span id="finalTime">00:00</span></p>
        </div>
        <button onclick="restartGame()" class="restart-btn">
            ðŸŽ® Main Lagi
        </button>
    </div>

    <script>
        let currentLevel = 3;
        let moves = 0;
        let startTime = null;
        let timerInterval = null;
        let selectedImage = 'https://images.unsplash.com/photo-1506744038136-46273834b3fb';
        let soundEnabled = true;
        let puzzleState = [];
        let emptyIndex = null;

        // State untuk tracking posisi
        let piecePositions = []; // Array untuk menyimpan posisi setiap potongan
        let correctPositions = []; // Array untuk posisi yang benar

        function initPuzzle() {
            const container = document.getElementById('puzzleContainer');
            container.innerHTML = '';
            
            // Set grid style
            container.style.gridTemplateColumns = `repeat(${currentLevel}, 1fr)`;
            container.style.gridTemplateRows = `repeat(${currentLevel}, 1fr)`;
            
            const totalPieces = currentLevel * currentLevel;
            puzzleState = [];
            piecePositions = [];
            correctPositions = [];
            
            // Initialize arrays
            for (let i = 0; i < totalPieces; i++) {
                puzzleState[i] = i; // piece number at position i
                piecePositions[i] = i; // position of piece number i
                correctPositions[i] = i; // correct position of piece i
            }
            
            // Set empty piece (last piece)
            emptyIndex = totalPieces - 1;
            
            // Shuffle the puzzle (but keep track of positions)
            shufflePuzzle();
            
            // Create puzzle pieces
            for (let position = 0; position < totalPieces; position++) {
                const piece = document.createElement('div');
                piece.className = 'puzzle-piece';
                piece.dataset.position = position;
                piece.dataset.pieceNumber = puzzleState[position];
                
                const pieceNum = puzzleState[position];
                
                if (pieceNum === totalPieces - 1) {
                    // This is the empty piece
                    piece.classList.add('empty');
                    piece.innerHTML = 'â¬›';
                } else {
                    // Calculate background position
                    const correctRow = Math.floor(pieceNum / currentLevel);
                    const correctCol = pieceNum % currentLevel;
                    
                    piece.style.backgroundImage = `url('${selectedImage}')`;
                    piece.style.backgroundSize = `${currentLevel * 100}%`;
                    piece.style.backgroundPosition = `${(correctCol / (currentLevel - 1)) * 100}% ${(correctRow / (currentLevel - 1)) * 100}%`;
                    
                    // Show piece number for debugging
                    // piece.innerHTML = `<span style="background: rgba(0,0,0,0.7); padding: 2px 5px; border-radius: 3px;">${pieceNum + 1}</span>`;
                }
                
                piece.onclick = () => movePiece(position);
                container.appendChild(piece);
            }
            
            moves = 0;
            document.getElementById('moves').textContent = moves;
        }

        function shufflePuzzle() {
            const totalPieces = currentLevel * currentLevel;
            let shuffleMoves = 100; // Jumlah acakan
            
            for (let i = 0; i < shuffleMoves; i++) {
                // Cari semua posisi yang bisa dipindah
                const validMoves = getValidMoves();
                
                // Pilih acak dari valid moves
                if (validMoves.length > 0) {
                    const randomMove = validMoves[Math.floor(Math.random() * validMoves.length)];
                    swapPieces(randomMove, emptyIndex);
                    emptyIndex = randomMove;
                }
            }
        }

        function getValidMoves() {
            const row = Math.floor(emptyIndex / currentLevel);
            const col = emptyIndex % currentLevel;
            const validMoves = [];
            
            // Check up
            if (row > 0) validMoves.push(emptyIndex - currentLevel);
            // Check down
            if (row < currentLevel - 1) validMoves.push(emptyIndex + currentLevel);
            // Check left
            if (col > 0) validMoves.push(emptyIndex - 1);
            // Check right
            if (col < currentLevel - 1) validMoves.push(emptyIndex + 1);
            
            return validMoves;
        }

        function movePiece(clickedPosition) {
            if (startTime === null) {
                startTimer();
            }
            
            // Cek apakah potongan yang diklik bersebelahan dengan kosong
            const rowClicked = Math.floor(clickedPosition / currentLevel);
            const colClicked = clickedPosition % currentLevel;
            const rowEmpty = Math.floor(emptyIndex / currentLevel);
            const colEmpty = emptyIndex % currentLevel;
            
            const isAdjacent = 
                (Math.abs(rowClicked - rowEmpty) === 1 && colClicked === colEmpty) ||
                (Math.abs(colClicked - colEmpty) === 1 && rowClicked === rowEmpty);
            
            if (isAdjacent) {
                // Swap pieces in state
                swapPieces(clickedPosition, emptyIndex);
                
                // Update UI
                updatePuzzleUI();
                
                // Update empty index
                emptyIndex = clickedPosition;
                
                // Update moves
                moves++;
                document.getElementById('moves').textContent = moves;
                
                // Check win
                checkWin();
            }
        }

        function swapPieces(pos1, pos2) {
            // Swap in puzzleState
            [puzzleState[pos1], puzzleState[pos2]] = [puzzleState[pos2], puzzleState[pos1]];
            
            // Update piecePositions
            piecePositions[puzzleState[pos1]] = pos1;
            piecePositions[puzzleState[pos2]] = pos2;
        }

        function updatePuzzleUI() {
            const pieces = document.querySelectorAll('.puzzle-piece');
            const totalPieces = currentLevel * currentLevel;
            
            pieces.forEach((piece, position) => {
                const pieceNum = puzzleState[position];
                
                // Update data attributes
                piece.dataset.position = position;
                piece.dataset.pieceNumber = pieceNum;
                
                if (pieceNum === totalPieces - 1) {
                    // Empty piece
                    piece.classList.add('empty');
                    // piece.innerHTML = 'â¬›';
                    piece.style.backgroundImage = 'none';
                } else {
                    // Regular piece
                    piece.classList.remove('empty');
                    
                    // Calculate background position
                    const correctRow = Math.floor(pieceNum / currentLevel);
                    const correctCol = pieceNum % currentLevel;
                    
                    piece.style.backgroundImage = `url('${selectedImage}')`;
                    piece.style.backgroundSize = `${currentLevel * 100}%`;
                    piece.style.backgroundPosition = `${(correctCol / (currentLevel - 1)) * 100}% ${(correctRow / (currentLevel - 1)) * 100}%`;
                    
                    // Update number display
                    // piece.innerHTML = `<span style="background: rgba(0,0,0,0.7); padding: 2px 5px; border-radius: 3px;">${pieceNum + 1}</span>`;
                }
            });
        }

        function checkWin() {
            const totalPieces = currentLevel * currentLevel;
            let isComplete = true;
            
            for (let i = 0; i < totalPieces; i++) {
                if (puzzleState[i] !== i) {
                    isComplete = false;
                    break;
                }
            }
            
            if (isComplete) {
                winGame();
            }
        }

        function winGame() {
            stopTimer();
            
            document.getElementById('finalMoves').textContent = moves;
            document.getElementById('finalTime').textContent = document.getElementById('time').textContent;
            document.getElementById('winMessage').classList.add('show');
            
            // Hilangkan angka dari potongan saat menang
            const pieces = document.querySelectorAll('.puzzle-piece:not(.empty)');
            pieces.forEach(piece => {
                piece.innerHTML = '';
            });
        }

        function startTimer() {
            startTime = new Date();
            timerInterval = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            const currentTime = new Date();
            const elapsed = Math.floor((currentTime - startTime) / 1000);
            const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
            const seconds = (elapsed % 60).toString().padStart(2, '0');
            document.getElementById('time').textContent = `${minutes}:${seconds}`;
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function restartGame() {
            moves = 0;
            startTime = null;
            stopTimer();
            
            document.getElementById('moves').textContent = '0';
            document.getElementById('time').textContent = '00:00';
            document.getElementById('winMessage').classList.remove('show');
            
            initPuzzle();
        }

        function changeLevel(level) {
            currentLevel = level;
            document.getElementById('level').textContent = `${level}x${level}`;
            restartGame();
        }

        function selectImage(element, imageUrl) {
            document.querySelectorAll('.image-option').forEach(img => {
                img.classList.remove('selected');
            });
            element.classList.add('selected');
            selectedImage = imageUrl;
            restartGame();
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('soundBtn').innerHTML = soundEnabled ? 'ðŸ”Š Sound On' : 'ðŸ”‡ Sound Off';
        }

        // Keyboard controls
        function setupKeyboardControls() {
            document.addEventListener('keydown', (e) => {
                if (!getValidMoves) return;
                
                const validMoves = getValidMoves();
                let targetIndex = null;
                
                switch(e.key) {
                    case 'ArrowUp':
                        targetIndex = emptyIndex + currentLevel; // Move piece below up
                        break;
                    case 'ArrowDown':
                        targetIndex = emptyIndex - currentLevel; // Move piece above down
                        break;
                    case 'ArrowLeft':
                        targetIndex = emptyIndex + 1; // Move piece right to left
                        break;
                    case 'ArrowRight':
                        targetIndex = emptyIndex - 1; // Move piece left to right
                        break;
                }
                
                if (targetIndex !== null && targetIndex >= 0 && targetIndex < currentLevel * currentLevel) {
                    if (validMoves.includes(targetIndex)) {
                        movePiece(targetIndex);
                        e.preventDefault();
                    }
                }
            });
        }

        // Initialize game
        window.onload = function() {
            initPuzzle();
            setupKeyboardControls();
        };
    </script>
</body>
</html>